{% extends "base.html" %}
{% load wagtailcore_tags static %}

{% block body_class %}template-homepage{% endblock %}

{% block content %}
<div class="container mt-5">
   <!-- Header con el nombre del dataset y el botón para obtener los datos -->
   <div class="d-flex justify-content-between align-items-center">
      <div>
         <div class="d-flex align-items-center mb-0">
            <p class="me-2 my-0"> {{ page.institution_related.name }} </p>
            {% if page.institution_related.verified %}
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2196f3"
               aria-label="Institución verificada"
               class="icon icon-tabler icons-tabler-filled icon-tabler-rosette-discount-check">
               <path stroke="none" d="M0 0h24v24H0z" fill="none" />
               <path
                  d="M12.01 2.011a3.2 3.2 0 0 1 2.113 .797l.154 .145l.698 .698a1.2 1.2 0 0 0 .71 .341l.135 .008h1a3.2 3.2 0 0 1 3.195 3.018l.005 .182v1c0 .27 .092 .533 .258 .743l.09 .1l.697 .698a3.2 3.2 0 0 1 .147 4.382l-.145 .154l-.698 .698a1.2 1.2 0 0 0 -.341 .71l-.008 .135v1a3.2 3.2 0 0 1 -3.018 3.195l-.182 .005h-1a1.2 1.2 0 0 0 -.743 .258l-.1 .09l-.698 .697a3.2 3.2 0 0 1 -4.382 .147l-.154 -.145l-.698 -.698a1.2 1.2 0 0 0 -.71 -.341l-.135 -.008h-1a3.2 3.2 0 0 1 -3.195 -3.018l-.005 -.182v-1a1.2 1.2 0 0 0 -.258 -.743l-.09 -.1l-.697 -.698a3.2 3.2 0 0 1 -.147 -4.382l.145 -.154l.698 -.698a1.2 1.2 0 0 0 .341 -.71l.008 -.135v-1l.005 -.182a3.2 3.2 0 0 1 3.013 -3.013l.182 -.005h1a1.2 1.2 0 0 0 .743 -.258l.1 -.09l.698 -.697a3.2 3.2 0 0 1 2.269 -.944zm3.697 7.282a1 1 0 0 0 -1.414 0l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.32 1.497l2 2l.094 .083a1 1 0 0 0 1.32 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" />
            </svg>
            {% endif %}
         </div>

         <div class="d-flex align-items-center">
            <h1>{{ page.title }} </h1>
            <span
               class="badge text-bg-secondary ms-2 text-uppercase bg-success bg-opacity-75 rounded-pill fs-5">{{page.file_format}}
            </span>
         </div>
      </div>
      <a href="{{ page.url_dataset }}" class="btn btn-primary px-4 py-2 rounded-3">Obtener datos</a>
   </div>

   <!-- Fecha de subida y ID -->
   <div class="text-secondary mb-3">
      Fecha de subida: {{ page.latest_revision_created_at|date:"m/d/Y" }} <br>
      ID: {{ page.id }}
   </div>

   <!-- Descripción del dataset -->
   <p>{{ page.description|richtext }}</p>

   <!-- Palabras clave -->
   <div class="mb-3">
      {% for keyword in page.keywords.all %}
      <span class="badge bg-secondary">{{ keyword }}</span>
      {% endfor %}
   </div>

   <!-- Ubicación, Fechas y Frecuencia -->
   <div class="d-flex flex-column gap-1 mb-3">
      <div class="me-3">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
            class="icon icon-tabler icons-tabler-filled icon-tabler-map-pin">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
               d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" />
         </svg>
         {{ page.location }}
      </div>
      <div class="me-3">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-calendar-month">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" />
            <path d="M16 3v4" />
            <path d="M8 3v4" />
            <path d="M4 11h16" />
            <path d="M7 14h.013" />
            <path d="M10.01 14h.005" />
            <path d="M13.01 14h.005" />
            <path d="M16.015 14h.005" />
            <path d="M13.015 17h.005" />
            <path d="M7.01 17h.005" />
            <path d="M10.01 17h.005" />
         </svg>
         {{ page.start_date|date:"m/d/Y" }} - {{ page.end_date|date:"m/d/Y" }}
      </div>
      <div class="me-3">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-clock">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
            <path d="M12 7v5l3 3" />
         </svg>
         Frecuencia de subida: {{ page.upload_frequency }}
      </div>
   </div>

   <!-- Citar -->
   <div class="mb-4">
      <h2 class="fs-3 border-bottom">Citar</h2>
      <div class="d-flex align-items-center">
         <p id="citationText" class="mb-0 me-3">{{ page.citation|richtext|striptags|linebreaksbr }}</p>
         <button type="button" class="btn btn-outline-primary btn-sm border-0" id="copyButton" onclick="copyCitation()"
            data-bs-toggle="tooltip" data-bs-title="Copiar cita">
            <svg id="copyIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               class="icon icon-tabler icon-tabler-copy">
               <path stroke="none" d="M0 0h24v24H0z" fill="none" />
               <path
                  d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
               <path
                  d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
            </svg>
         </button>
      </div>
   </div>

   <!-- Tabs de Información complementaria, Descripción de los datos, Contacto, Datos geográficos -->
   <ul class="nav nav-tabs" id="datasetTabs" role="tablist">
      <li class="nav-item" role="presentation">
         <a class="nav-link active" id="complementaria-tab" data-bs-toggle="tab" href="#complementaria" role="tab"
            aria-controls="complementaria" aria-selected="true">Información complementaria</a>
      </li>
      <li class="nav-item" role="presentation">
         <a class="nav-link" id="descripcion-tab" data-bs-toggle="tab" href="#descripcion" role="tab"
            aria-controls="descripcion" aria-selected="false">Descripción de los datos</a>
      </li>
      <li class="nav-item" role="presentation">
         <a class="nav-link" id="contacto-tab" data-bs-toggle="tab" href="#contacto" role="tab" aria-controls="contacto"
            aria-selected="false">Contacto</a>
      </li>
      <li class="nav-item" role="presentation">
         <a class="nav-link" id="geograficos-tab" data-bs-toggle="tab" href="#geograficos" role="tab"
            aria-controls="geograficos" aria-selected="false">Datos geográficos</a>
      </li>
   </ul>
   <div class="tab-content mt-3">
      <!-- Información complementaria -->
      <div class="tab-pane fade show active" id="complementaria" role="tabpanel" aria-labelledby="complementaria-tab">
         <ul class="list-unstyled">
            {% for info in page.additional_info.all %}
            <li class="row border-bottom mb-4">
               <h3 class="col-12 col-lg-3 fs-5">{{ info.title }}</h3>
               <p class="col">{{ info.description|richtext|striptags|linebreaksbr }}</p>
            </li>
            {% endfor %}
            <li class="row border-bottom mb-4">
               <h3 class="col-12 col-lg-3 fs-5">Limitaciones de uso</h3>
               <p class="col">{{page.use_limitations|richtext|striptags|linebreaksbr}}</p>
            </li>
            <li class="row border-bottom mb-4">
               <h3 class="col-12 col-lg-3 fs-5">Uso previsto</h3>
               <p class="col">{{page.intended_use|richtext|striptags|linebreaksbr}}</p>
            </li>
         </ul>
      </div>
      <!-- Descripción de los datos -->
      <div class="tab-pane fade" id="descripcion" role="tabpanel" aria-labelledby="descripcion-tab">
         <ul class="list-unstyled"></ul>
         {% for variables in page.data_dictionary.all %}
         <li class="row border-bottom mb-4">
            <div class="col-12 col-lg-3">
               <h3 class="fs-5">{{ variables.title }}</h3>
               <p class="text-secondary mb-1">Unidad: <strong>{{ variables.unit }}</strong></p>
            </div>
            <p class="col">{{ variables.description|richtext|striptags|linebreaksbr }}</p>
         </li>
         {% endfor %}
         </ul>
      </div>
      <!-- Contacto -->
      <div class="tab-pane fade" id="contacto" role="tabpanel" aria-labelledby="contacto-tab">
         <h3>{{ page.institution_related.name }}
            {% if page.institution_related.verified %}
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2196f3"
               aria-label="Institución verificada"
               class="icon icon-tabler icons-tabler-filled icon-tabler-rosette-discount-check">
               <path stroke="none" d="M0 0h24v24H0z" fill="none" />
               <path
                  d="M12.01 2.011a3.2 3.2 0 0 1 2.113 .797l.154 .145l.698 .698a1.2 1.2 0 0 0 .71 .341l.135 .008h1a3.2 3.2 0 0 1 3.195 3.018l.005 .182v1c0 .27 .092 .533 .258 .743l.09 .1l.697 .698a3.2 3.2 0 0 1 .147 4.382l-.145 .154l-.698 .698a1.2 1.2 0 0 0 -.341 .71l-.008 .135v1a3.2 3.2 0 0 1 -3.018 3.195l-.182 .005h-1a1.2 1.2 0 0 0 -.743 .258l-.1 .09l-.698 .697a3.2 3.2 0 0 1 -4.382 .147l-.154 -.145l-.698 -.698a1.2 1.2 0 0 0 -.71 -.341l-.135 -.008h-1a3.2 3.2 0 0 1 -3.195 -3.018l-.005 -.182v-1a1.2 1.2 0 0 0 -.258 -.743l-.09 -.1l-.697 -.698a3.2 3.2 0 0 1 -.147 -4.382l.145 -.154l.698 -.698a1.2 1.2 0 0 0 .341 -.71l.008 -.135v-1l.005 -.182a3.2 3.2 0 0 1 3.013 -3.013l.182 -.005h1a1.2 1.2 0 0 0 .743 -.258l.1 -.09l.698 -.697a3.2 3.2 0 0 1 2.269 -.944zm3.697 7.282a1 1 0 0 0 -1.414 0l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.32 1.497l2 2l.094 .083a1 1 0 0 0 1.32 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" />
            </svg>
            {% endif %}
         </h3>

         <p class="mb-0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Email"
               class="icon icon-tabler icons-tabler-outline icon-tabler-mail me-2">
               <path stroke="none" d="M0 0h24v24H0z" fill="none" />
               <path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" />
               <path d="M3 7l9 6l9 -6" />
            </svg>
            {{ page.institution_related.email }}
         </p>
         <p>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-label="Teléfono" class="icon icon-tabler icons-tabler-outline icon-tabler-phone me-2">
               <path stroke="none" d="M0 0h24H0z" fill="none" />
               <path
                  d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2" />
            </svg>
            {{ page.institution_related.phone }}
         </p>
      </div>
      <!-- Datos geográficos -->
      <div class="tab-pane fade" id="geograficos" role="tabpanel" aria-labelledby="geograficos-tab">
         <h3>Coordenadas del {{page.title}}</h3>
         {% for geo_data in page.geo_data.all %}
         {% if geo_data.geo_type == 'coords' %}
         <div class="d-flex gap-3">
            <p class="text-truncate mb-0" style="width: 110px;">Latitud: {{ geo_data.latitude }}</p>
            <p class="mb-0">Longitud: {{ geo_data.longitude }}</p>
         </div>
         {% else %}
         <div class="d-flex gap-3">
            <p class="text-truncate mb-0" style="width: 110px;">Región: {{ geo_data.region_name }}</p>
            <p class="mb-0">Municipalidad: {{ geo_data.municipality_name }}</p>
         </div>
         {% endif %}
         {% endfor %}
         <div id="map" class="mb-2 mt-3" style="height: 500px;"></div>
         <!-- Pasar las coordenadas al JS como un objeto JSON -->
         <script>
            var geoCoords = [
               {% for geo_data in page.geo_data.all %}
                  {% if geo_data.geo_type == 'coords' %}
                  {
                     "lat": {{ geo_data.latitude }},
                     "lng": {{ geo_data.longitude }}
                  },
                  {% endif %}
               {% endfor %}
            ];
         </script>
      </div>
   </div>
   <a href="{{ page.url_dataset }}" class="btn btn-primary mt-4 mb-5 px-4 py-2 rounded-3">Obtener datos</a>
</div>
<script src="{% static 'js/dataset_page.js' %}"></script>
{% endblock %}