{% extends "base.html" %}
{% load static wagtailcore_tags custom_filters%}
{% block content %}
<link rel="stylesheet" href="{% static 'css/search_results.css' %}">
<div class="row container-fluid my-4">
    <!-- Barra lateral de filtros -->
    <div class="col-md-3 collapse collapse-horizontal" id="collapseExample">
        <div class="card w-100">
            <div class="card-body">
                <h5>Fecha de datos</h5>
                <hr />
                <div class="input-group">
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" id="floatingStart" placeholder="Inicio">
                        <label for="floatingStart">Fecha inicio</label>
                    </div>
                    <div class="form-floating">
                        <input type="date" class="form-control" id="floatingEnd" placeholder="Fin">
                        <label for="floatingEnd">Fecha fin</label>
                    </div>
                </div>
                <h5 class="mt-3">Ubicación</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="guatemala" id="checkGuatemala">
                        <label class="form-check-label" for="checkGuatemala">
                            Guatemala
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="honduras" id="checkHonduras">
                        <label class="form-check-label" for="checkHonduras">
                            Honduras
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="nicaragua" id="checkNicaragua">
                        <label class="form-check-label" for="checkNicaragua">
                            Nicaragua
                        </label>
                    </li>
                </ul>

                <h5 class="mt-3">Variables</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="precipitacion" id="checkPrecipitacion">
                        <label class="form-check-label" for="checkPrecipitacion">
                            Precipitacion
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="temperatura" id="checkTemperatura">
                        <label class="form-check-label" for="checkTemperatura">
                            Temperatura
                        </label>
                    </li>
                </ul>

                <h5 class="mt-3">Instituciones</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="icc" id="checkICC">
                        <label class="form-check-label" for="checkICC">
                            ICC
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="disagro" id="checkDisagro">
                        <label class="form-check-label" for="checkDisagro">
                            Disagro
                        </label>
                    </li>
                </ul>

                <h5 class="mt-3">Acceso</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="libre" id="checkLibre">
                        <label class="form-check-label" for="checkLibre">
                            Libre
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="privado" id="checkPrivado">
                        <label class="form-check-label" for="checkPrivado">
                            Privado
                        </label>
                    </li>
                </ul>

                <h5 class="mt-3">Palabras claves</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="agrometeorologia"
                            id="checkAgrometeorologia">
                        <label class="form-check-label" for="checkAgrometeorologia">
                            Agrometeorología
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="estaciones" id="checkEstaciones">
                        <label class="form-check-label" for="checkEstaciones">
                            Estaciones
                        </label>
                    </li>
                </ul>

                <h5 class="mt-3">Frecuencia de subida</h5>
                <hr />
                <ul class="list-unstyled">
                    <li>
                        <input class="form-check-input" type="checkbox" value="diaria" id="checkDiaria">
                        <label class="form-check-label" for="checkDiaria">
                            Diaria
                        </label>
                    </li>
                    <li>
                        <input class="form-check-input" type="checkbox" value="mensualemente" id="checkMensualmente">
                        <label class="form-check-label" for="checkMensualmente">
                            Mensualmente
                        </label>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Resultados de la búsqueda -->
    <div class="col">
        <div class="d-flex align-items-center mb-2">
            <!-- Botón de filtros -->
            <button type="button" class="btn btn-outline-secondary d-flex align-items-center me-4 btn-filters"
                data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false"
                aria-controls="collapseExample">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-tabler icons-tabler-outline icon-tabler-adjustments-horizontal me-2">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                    <path d="M4 6l8 0" />
                    <path d="M16 6l4 0" />
                    <path d="M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                    <path d="M4 12l2 0" />
                    <path d="M10 12l10 0" />
                    <path d="M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                    <path d="M4 18l11 0" />
                    <path d="M19 18l1 0" />
                </svg>
                Todos los filtros
            </button>
            <!-- Barra de búsqueda -->
            <div class="position-relative w-100">
                <span class="position-absolute search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-search">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
                        <path d="M21 21l-6 -6" />
                    </svg>
                </span>
                <input type="search" id="searchInput" class="form-control ps-5" placeholder="Buscar..."
                    aria-label="Search">
            </div>

        </div>

        {% if datasets %}
        {% for dataset in datasets %}
        <div id="resultsContainer" class="card mb-3">
            <div class="card-body">
                <div class="row">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="/{{ dataset.title|slugify }}" class="text-decoration-none text-reset" target="_blank">
                            <div class="d-flex align-items-center">
                                {% if dataset.type_dataset == "restricted" %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"
                                    fill="currentColor"
                                    class="icon icon-tabler icons-tabler-filled icon-tabler-lock me-2">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M12 2a5 5 0 0 1 5 5v3a3 3 0 0 1 3 3v6a3 3 0 0 1 -3 3h-10a3 3 0 0 1 -3 -3v-6a3 3 0 0 1 3 -3v-3a5 5 0 0 1 5 -5m0 12a2 2 0 0 0 -1.995 1.85l-.005 .15a2 2 0 1 0 2 -2m0 -10a3 3 0 0 0 -3 3v3h6v-3a3 3 0 0 0 -3 -3" />
                                </svg>
                                {% endif %}
                                <div>
                                    <div class="d-flex align-items-center">
                                        <h1 class="mb-0">{{ dataset.title }} </h1>
                                        {% if dataset.file_format %}
                                        {% for format in dataset.file_format|split:"," %}
                                        <span
                                            class="badge text-bg-secondary ms-2 text-uppercase bg-success bg-opacity-75 rounded-pill fs-5">
                                            {{ format }}
                                        </span>
                                        {% endfor %}
                                        {% endif %}
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <p class="me-2 my-0"> {{ dataset.institution_related.name }} </p>
                                        {% if dataset.institution_related.verified %}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2196f3"
                                            aria-label="Institución verificada"
                                            class="icon icon-tabler icons-tabler-filled icon-tabler-rosette-discount-check">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <path
                                                d="M12.01 2.011a3.2 3.2 0 0 1 2.113 .797l.154 .145l.698 .698a1.2 1.2 0 0 0 .71 .341l.135 .008h1a3.2 3.2 0 0 1 3.195 3.018l.005 .182v1c0 .27 .092 .533 .258 .743l.09 .1l.697 .698a3.2 3.2 0 0 1 .147 4.382l-.145 .154l-.698 .698a1.2 1.2 0 0 0 -.341 .71l-.008 .135v1a3.2 3.2 0 0 1 -3.018 3.195l-.182 .005h-1a1.2 1.2 0 0 0 -.743 .258l-.1 .09l-.698 .697a3.2 3.2 0 0 1 -4.382 .147l-.154 -.145l-.698 -.698a1.2 1.2 0 0 0 -.71 -.341l-.135 -.008h-1a3.2 3.2 0 0 1 -3.195 -3.018l-.005 -.182v-1a1.2 1.2 0 0 0 -.258 -.743l-.09 -.1l-.697 -.698a3.2 3.2 0 0 1 -.147 -4.382l.145 -.154l.698 -.698a1.2 1.2 0 0 0 .341 -.71l.008 -.135v-1l.005 -.182a3.2 3.2 0 0 1 3.013 -3.013l.182 -.005h1a1.2 1.2 0 0 0 .743 -.258l.1 -.09l.698 -.697a3.2 3.2 0 0 1 2.269 -.944zm3.697 7.282a1 1 0 0 0 -1.414 0l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.32 1.497l2 2l.094 .083a1 1 0 0 0 1.32 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" />
                                        </svg>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </a>
                        {% if dataset.type_dataset == "public" %}
                        <a href="{{ dataset.url_dataset }}" target="_blank" class="btn btn-primary px-4 py-2 rounded-3">
                            Obtener datos
                        </a>
                        {% elif dataset.type_dataset == "restricted" %}
                        <button type="button" class="btn btn-primary px-4 py-2 rounded-3" data-bs-toggle="modal"
                            data-bs-target="#requestModal">
                            Solicitar acceso
                        </button>
                        {% endif %}
                    </div>

                    <!-- Fecha de subida-->
                    <div class="text-secondary mb-2">
                        Fecha de subida: {{ dataset.latest_revision_created_at|date:"m/d/Y" }}
                    </div>

                    <!-- Descripción del dataset -->
                    {{ dataset.description|richtext|remove_empty_tags|richtext }}
                    <p class="text-muted mb-0">Autores: <strong>{{dataset.authors}}</strong></p>
                    <p class="text-muted mb-1">Instituciones asociadas:
                        <strong>{{dataset.partner_institutions}}</strong>
                    </p>
                    <!-- Palabras clave -->
                    <div class="mb-2">
                        {% with dataset.keywords|split:", " as keywords_list %}
                        {% for keyword in keywords_list %}
                        <span class="badge bg-secondary">{{ keyword }}</span>
                        {% endfor %}
                        {% endwith %}
                    </div>

                    <!--  Fechas y Frecuencia -->
                    <div class="d-flex flex-column gap-1 mb-3">
                        {% if dataset.start_date and dataset.end_date %}
                        <div class="d-flex align-items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round"
                                class="icon icon-tabler icons-tabler-outline icon-tabler-calendar-month me-1">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path
                                    d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" />
                                <path d="M16 3v4" />
                                <path d="M8 3v4" />
                                <path d="M4 11h16" />
                                <path d="M7 14h.013" />
                                <path d="M10.01 14h.005" />
                                <path d="M13.01 14h.005" />
                                <path d="M16.015 14h.005" />
                                <path d="M13.015 17h.005" />
                                <path d="M7.01 17h.005" />
                                <path d="M10.01 17h.005" />
                            </svg>
                            Periodo de tiempo:
                            {{ dataset.start_date|date:"m/d/Y" }} - {{ dataset.end_date|date:"m/d/Y" }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>No se encontraron datasets.</p>
        {% endif %}
    </div>
</div>
<script src="{% static 'js/search_results.js' %}"></script>
{% endblock %}